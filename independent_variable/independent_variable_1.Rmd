---
title: "Select independent variable"
output: html_document
date: "2025-04-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ƒê·ªçc d·ªØ li·ªáu ƒë√£ l√†m s·∫°ch

```{r}
library(broom)
library(knitr)
library(broom)
library(knitr)
library(dplyr)
library(ggcorrplot)     # V·∫Ω ma tr·∫≠n t∆∞∆°ng quan
library(ggplot2)
library(car)            # T√≠nh VIF
library(corrplot)       # V·∫Ω bi·ªÉu ƒë·ªì t∆∞∆°ng quan
data_cleaned <- read.csv("../data_set/data_cleaned.csv")
```

# ch·ªçn bi·∫øn d·ª±a tr√™n c∆° s·ªü l√Ω thuy·∫øt tr∆∞·ªõc ƒë√≥ (ƒë·ªçc v√† nghi√™n c·ª©u file csv ho·∫∑c t√¨m hi·ªÉu c√°c nghi√™n c·ª©u t∆∞∆°ng t·ª±) ƒëi ƒë·∫øn ch·ªçn bi·∫øn v√† ƒëem ƒëi ki·ªÉm ƒë·ªãnh b·∫±ng ph∆∞∆°ng ph√°p s·ª≠ d·ª•ng ma tr·∫≠n t∆∞∆°ng quan ƒë·ªÉ ki·ªÉm tra

```{r}
# L·ª±a ch·ªçn c√°c bi·∫øn c√≥ t∆∞∆°ng quan t·ªët v√† kh√¥ng ƒëa c·ªông tuy·∫øn cao
selected_data <- data_cleaned %>%
  select(LIFE.EXPECTANCY, INCOME.COMPOSITION.OF.RESOURCES, ADULT.MORTALITY, INFANT.DEATHS, BMI,PERCENTAGE.EXPENDITURE,TOTAL.EXPENDITURE, SCHOOLING)
```

```{r}
#T√≠nh v√† v·∫Ω ma tr·∫≠n t∆∞∆°ng quan
cor_matrix <- cor(selected_data, use = "complete.obs")

ggcorrplot(
  cor_matrix,
  hc.order = FALSE,  # T·∫Øt s·∫Øp x·∫øp ph√¢n c·ª•m ƒë·ªÉ gi·ªØ nguy√™n th·ª© t·ª± bi·∫øn
  type = "full",     # Hi·ªÉn th·ªã to√†n b·ªô ma tr·∫≠n (kh√¥ng ch·ªâ n·ª≠a d∆∞·ªõi)
  lab = TRUE,
  lab_size = 3,
  tl.cex = 8,        # TƒÉng k√≠ch th∆∞·ªõc ch·ªØ t√™n bi·∫øn
  tl.srt = 45,       # Xoay t√™n bi·∫øn 45 ƒë·ªô
  title = "Ma tr·∫≠n t∆∞∆°ng quan gi·ªØa c√°c bi·∫øn",
) +
  theme(
    axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
    axis.text.y = element_text(size = 8)
  )
```

# -------------------------------------------------------------------

# \>\>\>\>\> X√ÇY D·ª∞NG C√ÅC M√î H√åNH \<\<\<\<\<

> > final ƒë√£ r·ªìi t ghi document sau

# M√î H√åNH 1

```{r}
model1 <- lm(LIFE.EXPECTANCY ~ INCOME.COMPOSITION.OF.RESOURCES + ADULT.MORTALITY + SCHOOLING + PERCENTAGE.EXPENDITURE, data = selected_data)
```

> > Target: D·ª± ƒëo√°n tu·ªïi th·ªç d·ª±a tr√™n c√°c y·∫øu t·ªë kionh t·∫ø, y t·∫ø v√† gi√°o d·ª•c

# M√î H√åNH 2

```{r}

model2 <- lm(LIFE.EXPECTANCY ~ INCOME.COMPOSITION.OF.RESOURCES * SCHOOLING + ADULT.MORTALITY,
  data = selected_data)

```

> > Income.composition.of.resources \* Schooling: √Ω nghƒ©a gi√°o d·ª•c cao -\> c√≥ th·ªÉ t√°c ƒë·ªông ƒë·∫øn kho·∫£ng thu nh·∫≠p -\> kho·∫£ng thu nh·∫≠p cao -\> ch·∫•t l∆∞·ª£ng cu·ªôc s·ªëng t·ªët -\> ·∫£nh h∆∞·ªüng ƒë·∫øn tu·ªïi th·ªç

# M√î H√åNH 3

> > Lasso

```{r}

```

------------------------------------------------------------------------

# K·∫æT QU·∫¢
```{r}
# H√†m in k·∫øt qu·∫£
print_results <- function(model, model_name = "M√¥ h√¨nh") {
  # H·ªá s·ªë
  cat("\n", paste0("=== ", model_name, " ==="), "\n")
  
  coef_table <- tidy(model) %>%
  mutate(
    significance = ifelse(p.value < 0.001, "***", 
                          ifelse(p.value < 0.01, "**", 
                                 ifelse(p.value < 0.05, "*", "NS"))) # Th√™m "NS" cho kh√¥ng c√≥ √Ω nghƒ©a th·ªëng k√™
  )

  
  # ƒê·ªïi t√™n c·ªôt c√≥ th·ªÉ ng·∫Øt d√≤ng (HTML c·∫ßn escape = FALSE)
  colnames(coef_table) <- c(
    "Bi·∫øn<br>(term)", 
    "∆Ø·ªõc l∆∞·ª£ng<br>(estimate)", 
    "Sai s·ªë<br>(std.error)", 
    "Gi√° tr·ªã t<br>(statistic)", 
    "Gi√° tr·ªã p<br>(p.value)", 
    "√ù nghƒ©a<br>th·ªëng k√™"
  )
    # In b·∫£ng ƒë·∫πp
  print(kable(coef_table, digits = 3, caption = "üìå H·ªá s·ªë h·ªìi quy"))
  
  # Model summary
  model_summary <- glance(model) %>%
  select(r.squared, adj.r.squared, sigma, statistic, p.value, nobs)
  colnames(model_summary) <- c("R¬≤", "R¬≤ hi·ªáu ch·ªânh", "Sai s·ªë", "F", "p-value", "N")
  print(kable(model_summary, digits = 3, caption = "Ch·ªâ s·ªë t·ªïng quan"))
  
  # VIF (kh√¥ng √°p d·ª•ng cho model c√≥ interaction n·∫øu ch∆∞a chu·∫©n h√≥a) (MODEL 2)
  if (!any(grepl(":", names(coef(model))))) { # Check interaction terms
    vif_values <- car::vif(model)
    print(kable(data.frame(VIF = vif_values), digits = 1, caption = "Ki·ªÉm tra VIF"))
  }
}

```

```{r}

print_results(model1)

```

```{r}
print_results(model2)
```

